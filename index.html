<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Messages</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        // Import Firebase SDK
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
        import { getDatabase, ref, push, onChildAdded, query, orderByChild, limitToLast } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC3KE1VFcuBrh5z4v1ZEDBmTE0kgemL5CQ",
            authDomain: "random-messages-5cc65.firebaseapp.com",
            databaseURL: "https://random-messages-5cc65-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "random-messages-5cc65",
            storageBucket: "random-messages-5cc65.firebasestorage.app",
            messagingSenderId: "477081432884",
            appId: "1:477081432884:web:bb15646788c9aec43feb61",
            measurementId: "G-Y2ECZGTG9E"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const messagesRef = ref(database, 'messages');

        // DOM elements
        const usernameInput = document.getElementById('usernameInput');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const messagesDiv = document.getElementById('messages');

        // Load username from localStorage
        const savedUsername = localStorage.getItem('username') || '';
        usernameInput.value = savedUsername;

        // Save username to localStorage on input
        usernameInput.addEventListener('input', () => {
            const username = usernameInput.value.trim().slice(0, 20);
            localStorage.setItem('username', username);
        });

        // Get username (fallback to Anonymous)
        function getUsername() {
            const username = usernameInput.value.trim().slice(0, 20);
            return username || 'Anonymous';
        }

        // Map country codes to flags
        const countryToFlag = {
            'RU': { flag: 'russia.png', label: 'IP: Russia' },
            'UA': { flag: 'ukraine.png', label: 'IP: Ukraine' },
            'BY': { flag: 'belarus.png', label: 'IP: Belarus' },
            'CH': { flag: 'switzerland.png', label: 'IP: Switzerland' },
            'LI': { flag: 'liechtenstein.png', label: 'IP: Liechtenstein' },
            'RS': { flag: 'serbia.png', label: 'IP: Serbia' }
        };
        const euCountries = ['AT', 'BE', 'BG', 'HR', 'CY', 'CZ', 'DK', 'EE', 'FI', 'FR', 'DE', 'GR', 'HU', 'IE', 'IT', 'LV', 'LT', 'LU', 'MT', 'NL', 'PL', 'PT', 'RO', 'SK', 'SI', 'ES', 'SE'];
        const americas = ['US', 'CA', 'MX', 'BR', 'AR', 'CL', 'CO', 'PE'];
        const africa = ['ZA', 'NG', 'KE', 'GH', 'EG'];
        const asia = ['CN', 'JP', 'IN', 'KR', 'ID'];
        const oceania = ['AU', 'NZ'];

        // Get flag based on country code
        async function getFlagForCountry() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                const countryCode = data.country_code;
                if (countryToFlag[countryCode]) {
                    return countryToFlag[countryCode];
                } else if (euCountries.includes(countryCode)) {
                    return { flag: 'eu.png', label: 'IP: EU' };
                } else if (americas.includes(countryCode)) {
                    return { flag: 'americas.png', label: 'IP: Americas' };
                } else if (africa.includes(countryCode)) {
                    return { flag: 'africa.png', label: 'IP: Africa' };
                } else if (asia.includes(countryCode)) {
                    return { flag: 'asia.png', label: 'IP: Asia' };
                } else if (oceania.includes(countryCode)) {
                    return { flag: 'australia.png', label: 'IP: Australia/Oceania' };
                }
                return { flag: 'un.png', label: 'IP: Unknown' };
            } catch (error) {
                console.error('Error fetching IP data:', error);
                return { flag: 'un.png', label: 'IP: Unknown' };
            }
        }

        // Send message
        sendButton.addEventListener('click', async () => {
            const message = messageInput.value.trim();
            if (message) {
                const username = getUsername();
                const flagData = await getFlagForCountry();
                push(messagesRef, {
                    username: username,
                    text: message,
                    flag: flagData.flag,
                    ipLabel: flagData.label,
                    timestamp: Date.now()
                });
                messageInput.value = '';
            }
        });

        // Press Enter to send
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendButton.click();
            }
        });

        // Display messages
        onChildAdded(query(messagesRef, orderByChild('timestamp'), limitToLast(50)), (snapshot) => {
            const data = snapshot.val();
            const messageElement = document.createElement('div');
            const isRegion = ['americas.png', 'africa.png', 'asia.png', 'australia.png'].includes(data.flag);
            messageElement.innerHTML = `<img src="flags/${data.flag}" class="${isRegion ? 'map' : 'flag'}" alt="${data.ipLabel}"> ${data.ipLabel} [${data.username}]: ${data.text}`;
            messagesDiv.appendChild(messageElement);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });

        // Auto-scroll to bottom
        messagesDiv.addEventListener('DOMNodeInserted', () => {
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    </script>
    <style>
        body {
            background-color: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', Courier, monospace;
        }
        #messages {
            max-height: 70vh;
            overflow-y: auto;
            scroll-behavior: smooth;
        }
        #messages::-webkit-scrollbar {
            width: 8px;
        }
        #messages::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        #messages::-webkit-scrollbar-thumb {
            background: #00ff00;
            border-radius: 4px;
        }
        input, button {
            background-color: #2a2a2a;
            color: #00ff00;
            border: 1px solid #00ff00;
            font-family: 'Courier New', Courier, monospace;
        }
        input:focus, button:focus {
            outline: none;
            border-color: #00cc00;
        }
        button:hover {
            background-color: #00cc00;
            color: #1a1a1a;
        }
        img.flag {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            vertical-align: middle;
            margin-right: 8px;
            object-fit: cover;
        }
        img.map {
            width: 24px;
            height: 16px;
            vertical-align: middle;
            margin-right: 8px;
            object-fit: cover;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">
    <pre class="text-center text-sm sm:text-base mb-4">
░█▀▀▄░█▀▀▄░█▀▀▄░█▀▄░▄▀▀▄░█▀▄▀█░░░█▀▄▀█░█▀▀▄░█▀▀░█▀▀░█▀▀▄░█▀▀▀░█▀▀░█▀▀
░█▄▄▀░█▄▄█░█░▒█░█░█░█░░█░█░▀░█░░░█░▀░█░█▄▄█░▀▀▄░▀▀▄░█▄▄█░█░▀▄░█▀▀░▀▀▄
░▀░▀▀░▀░░▀░▀░░▀░▀▀░░░▀▀░░▀░░▒▀░░░▀░░▒▀░▀░░▀░▀▀▀░▀▀▀░▀░░▀░▀▀▀▀░▀▀▀░▀▀▀
    </pre>
    <h1 class="text-2xl font-bold mb-4">Random Messages</h1>
    <div class="w-full max-w-2xl">
        <div class="flex space-x-2 mb-2">
            <input id="usernameInput" type="text" class="flex-1 p-2 rounded" placeholder="Enter your username..." maxlength="20">
        </div>
        <div id="messages" class="border border-green-500 p-4 mb-4 rounded"></div>
        <div class="flex space-x-2">
            <input id="messageInput" type="text" class="flex-1 p-2 rounded" placeholder="Type your message..." maxlength="200">
            <button id="sendButton" class="px-4 py-2 rounded">Send</button>
        </div>
    </div>
</body>
</html>